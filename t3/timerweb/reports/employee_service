-- SORT GROUP: Management Reports
-- TITLE: Service Periods of Employees

print "Service periods for all employees"
print "Period from [start_date] to [end_date]"
print ""
print ""
go

select tl.emp "E", $(employee_name e) "employee",
		convert(char(12), min(tl.date), 107) "first worked",
		convert(char(12), max(tl.date), 107) "last worked"
from time_log tl, employee e
where tl.emp = e.emp
and tl.date between '[start_date]' and '[end_date]'
and exists
(
	select 1
	from pay_rate pr
	where tl.emp = pr.emp
	and pr.rate_type = 'P'
	and tl.client = isnull(pr.client, tl.client)
	and tl.proj = isnull(pr.proj, tl.proj)
	and tl.date between pr.start_date and pr.end_date
)
group by tl.emp, $(employee_name e)
go
